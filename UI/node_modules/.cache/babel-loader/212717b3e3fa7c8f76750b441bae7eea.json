{"ast":null,"code":"var _jsxFileName = \"/Users/toddstorm/workspace/mechanism-take-home/UI/src/hooks/useAppJwt.js\";\nimport React, { useContext, useEffect, useState } from 'react';\nimport JwtContext from '../providers/JwtContext';\nimport _ from 'lodash';\nimport firebase from \"firebase/app\";\nimport { Redirect } from 'react-router-dom';\n\nconst useAppJwt = () => {\n  const {\n    appToken,\n    setAppToken\n  } = useContext(JwtContext);\n  const [user, setUser] = useState({});\n  useEffect(() => {\n    firebase.auth().onAuthStateChanged(function (user) {\n      if (user) {\n        setUser(user);\n        user.getIdToken().then(token => {\n          setAppToken(token);\n        });\n      }\n\n      if (!user) {\n        var provider = new firebase.auth.GoogleAuthProvider();\n        firebase.auth().setPersistence(firebase.auth.Auth.Persistence.LOCAL).then(() => {\n          firebase.auth().signInWithPopup(provider).then(function (result) {\n            setAppToken(firebase.auth().currentUser.getIdToken());\n          }).catch(function (error) {});\n        });\n        console.log(\"redirecting\");\n        return /*#__PURE__*/React.createElement(Redirect, {\n          to: \"/\",\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 30,\n            columnNumber: 14\n          }\n        });\n      }\n    });\n  }, [setAppToken]);\n\n  function isAuthenticated() {\n    return !_.isUndefined(firebase.auth().currentUser);\n  }\n\n  ;\n\n  function logout() {\n    setAppToken('');\n    firebase.auth().signOut();\n  }\n\n  return {\n    appToken,\n    isAuthenticated,\n    logout,\n    user\n  };\n};\n\nexport default useAppJwt;","map":{"version":3,"sources":["/Users/toddstorm/workspace/mechanism-take-home/UI/src/hooks/useAppJwt.js"],"names":["React","useContext","useEffect","useState","JwtContext","_","firebase","Redirect","useAppJwt","appToken","setAppToken","user","setUser","auth","onAuthStateChanged","getIdToken","then","token","provider","GoogleAuthProvider","setPersistence","Auth","Persistence","LOCAL","signInWithPopup","result","currentUser","catch","error","console","log","isAuthenticated","isUndefined","logout","signOut"],"mappings":";AAAA,OAAOA,KAAP,IAAgBC,UAAhB,EAA4BC,SAA5B,EAAuCC,QAAvC,QAAuD,OAAvD;AACA,OAAOC,UAAP,MAAuB,yBAAvB;AACA,OAAOC,CAAP,MAAc,QAAd;AACA,OAAOC,QAAP,MAAqB,cAArB;AACA,SAASC,QAAT,QAAyB,kBAAzB;;AAEA,MAAMC,SAAS,GAAG,MAAM;AACtB,QAAM;AAAEC,IAAAA,QAAF;AAAYC,IAAAA;AAAZ,MAA4BT,UAAU,CAACG,UAAD,CAA5C;AACA,QAAM,CAACO,IAAD,EAAOC,OAAP,IAAkBT,QAAQ,CAAC,EAAD,CAAhC;AAEDD,EAAAA,SAAS,CAAC,MAAM;AACfI,IAAAA,QAAQ,CAACO,IAAT,GAAgBC,kBAAhB,CAAmC,UAASH,IAAT,EAAe;AAChD,UAAIA,IAAJ,EAAU;AACRC,QAAAA,OAAO,CAACD,IAAD,CAAP;AACAA,QAAAA,IAAI,CAACI,UAAL,GAAkBC,IAAlB,CAAwBC,KAAD,IAAW;AAChCP,UAAAA,WAAW,CAACO,KAAD,CAAX;AACD,SAFD;AAGD;;AACD,UAAI,CAACN,IAAL,EAAW;AACT,YAAIO,QAAQ,GAAG,IAAIZ,QAAQ,CAACO,IAAT,CAAcM,kBAAlB,EAAf;AACAb,QAAAA,QAAQ,CAACO,IAAT,GAAgBO,cAAhB,CAA+Bd,QAAQ,CAACO,IAAT,CAAcQ,IAAd,CAAmBC,WAAnB,CAA+BC,KAA9D,EACCP,IADD,CACM,MAAM;AACZV,UAAAA,QAAQ,CAACO,IAAT,GACEW,eADF,CACkBN,QADlB,EAC4BF,IAD5B,CACiC,UAASS,MAAT,EAAiB;AAC9Cf,YAAAA,WAAW,CAACJ,QAAQ,CAACO,IAAT,GAAgBa,WAAhB,CAA4BX,UAA5B,EAAD,CAAX;AACF,WAHF,EAGIY,KAHJ,CAGU,UAASC,KAAT,EAAgB,CACxB,CAJF;AAKC,SAPD;AAQAC,QAAAA,OAAO,CAACC,GAAR,CAAY,aAAZ;AACA,4BAAO,oBAAC,QAAD;AAAU,UAAA,EAAE,EAAC,GAAb;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,UAAP;AACD;AACF,KApBD;AAqBA,GAtBQ,EAsBN,CAACpB,WAAD,CAtBM,CAAT;;AAyBC,WAASqB,eAAT,GAA2B;AACzB,WAAO,CAAC1B,CAAC,CAAC2B,WAAF,CAAc1B,QAAQ,CAACO,IAAT,GAAgBa,WAA9B,CAAR;AACD;;AAAA;;AAED,WAASO,MAAT,GAAkB;AAChBvB,IAAAA,WAAW,CAAC,EAAD,CAAX;AACAJ,IAAAA,QAAQ,CAACO,IAAT,GAAgBqB,OAAhB;AACD;;AAED,SAAO;AACLzB,IAAAA,QADK;AAELsB,IAAAA,eAFK;AAGLE,IAAAA,MAHK;AAILtB,IAAAA;AAJK,GAAP;AAMD,CA5CD;;AA8CA,eAAeH,SAAf","sourcesContent":["import React, { useContext, useEffect, useState } from 'react';\nimport JwtContext from '../providers/JwtContext';\nimport _ from 'lodash';\nimport firebase from \"firebase/app\";\nimport { Redirect } from 'react-router-dom';\n\nconst useAppJwt = () => {\n  const { appToken, setAppToken } = useContext(JwtContext);\n  const [user, setUser] = useState({});\n\n useEffect(() => {\n  firebase.auth().onAuthStateChanged(function(user) {\n    if (user) {\n      setUser(user);\n      user.getIdToken().then((token) => {\n        setAppToken(token);\n      });\n    }\n    if (!user) {\n      var provider = new firebase.auth.GoogleAuthProvider();\n      firebase.auth().setPersistence(firebase.auth.Auth.Persistence.LOCAL)\n      .then(() => {\n      firebase.auth()\n       .signInWithPopup(provider).then(function(result) {\n          setAppToken(firebase.auth().currentUser.getIdToken());\n       }).catch(function(error) {\n       });\n      });\n      console.log(\"redirecting\");\n      return <Redirect to=\"/\" />;\n    }\n  });\n }, [setAppToken])\n\n\n  function isAuthenticated() {\n    return !_.isUndefined(firebase.auth().currentUser);\n  };\n\n  function logout() {\n    setAppToken('');\n    firebase.auth().signOut();\n  }\n\n  return {\n    appToken,\n    isAuthenticated,\n    logout,\n    user,\n  };\n};\n\nexport default useAppJwt;\n"]},"metadata":{},"sourceType":"module"}