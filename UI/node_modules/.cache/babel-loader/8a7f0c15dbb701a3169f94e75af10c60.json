{"ast":null,"code":"import { useContext, useEffect, useState } from 'react';\nimport JwtContext from '../providers/JwtContext';\nimport _ from 'lodash';\nimport firebase from \"firebase/app\";\n\nconst useAppJwt = () => {\n  const {\n    appToken,\n    setAppToken\n  } = useContext(JwtContext);\n  const [user, setUser] = useState({});\n  useEffect(() => {\n    firebase.auth().onAuthStateChanged(function (user) {\n      if (user) {\n        setUser(user);\n        user.getIdToken().then(token => {\n          setAppToken(token);\n        });\n      }\n\n      if (!user) {\n        var provider = new firebase.auth.GoogleAuthProvider();\n        firebase.auth().setPersistence(firebase.auth.Auth.Persistence.LOCAL).then(() => {\n          firebase.auth().signInWithPopup(provider).then(function (result) {\n            console.log(\"token\", firebase.auth().currentUser.getIdToken());\n            setAppToken(firebase.auth().currentUser.getIdToken());\n            console.log(user);\n          }).catch(function (error) {\n            console.log(error.code);\n            console.log(error.message);\n          });\n        });\n      }\n    });\n  }, [setAppToken]);\n\n  function isAuthenticated() {\n    return !_.isUndefined(firebase.auth().currentUser);\n  }\n\n  ;\n\n  function logout() {\n    setAppToken('');\n    firebase.auth().signOut();\n  }\n\n  return {\n    appToken,\n    isAuthenticated,\n    logout,\n    user\n  };\n};\n\nexport default useAppJwt;","map":{"version":3,"sources":["/Users/toddstorm/workspace/mechanism-take-home/UI/src/hooks/useAppJwt.js"],"names":["useContext","useEffect","useState","JwtContext","_","firebase","useAppJwt","appToken","setAppToken","user","setUser","auth","onAuthStateChanged","getIdToken","then","token","provider","GoogleAuthProvider","setPersistence","Auth","Persistence","LOCAL","signInWithPopup","result","console","log","currentUser","catch","error","code","message","isAuthenticated","isUndefined","logout","signOut"],"mappings":"AAAA,SAASA,UAAT,EAAqBC,SAArB,EAAgCC,QAAhC,QAAgD,OAAhD;AACA,OAAOC,UAAP,MAAuB,yBAAvB;AACA,OAAOC,CAAP,MAAc,QAAd;AACA,OAAOC,QAAP,MAAqB,cAArB;;AAEA,MAAMC,SAAS,GAAG,MAAM;AACtB,QAAM;AAAEC,IAAAA,QAAF;AAAYC,IAAAA;AAAZ,MAA4BR,UAAU,CAACG,UAAD,CAA5C;AACA,QAAM,CAACM,IAAD,EAAOC,OAAP,IAAkBR,QAAQ,CAAC,EAAD,CAAhC;AAEDD,EAAAA,SAAS,CAAC,MAAM;AACfI,IAAAA,QAAQ,CAACM,IAAT,GAAgBC,kBAAhB,CAAmC,UAASH,IAAT,EAAe;AAChD,UAAIA,IAAJ,EAAU;AACRC,QAAAA,OAAO,CAACD,IAAD,CAAP;AACAA,QAAAA,IAAI,CAACI,UAAL,GAAkBC,IAAlB,CAAwBC,KAAD,IAAW;AAChCP,UAAAA,WAAW,CAACO,KAAD,CAAX;AACD,SAFD;AAGD;;AACD,UAAI,CAACN,IAAL,EAAW;AACT,YAAIO,QAAQ,GAAG,IAAIX,QAAQ,CAACM,IAAT,CAAcM,kBAAlB,EAAf;AACAZ,QAAAA,QAAQ,CAACM,IAAT,GAAgBO,cAAhB,CAA+Bb,QAAQ,CAACM,IAAT,CAAcQ,IAAd,CAAmBC,WAAnB,CAA+BC,KAA9D,EACCP,IADD,CACM,MAAM;AACZT,UAAAA,QAAQ,CAACM,IAAT,GACEW,eADF,CACkBN,QADlB,EAC4BF,IAD5B,CACiC,UAASS,MAAT,EAAiB;AAC9CC,YAAAA,OAAO,CAACC,GAAR,CAAY,OAAZ,EAAqBpB,QAAQ,CAACM,IAAT,GAAgBe,WAAhB,CAA4Bb,UAA5B,EAArB;AACAL,YAAAA,WAAW,CAACH,QAAQ,CAACM,IAAT,GAAgBe,WAAhB,CAA4Bb,UAA5B,EAAD,CAAX;AACAW,YAAAA,OAAO,CAACC,GAAR,CAAYhB,IAAZ;AACF,WALF,EAKIkB,KALJ,CAKU,UAASC,KAAT,EAAgB;AACtBJ,YAAAA,OAAO,CAACC,GAAR,CAAYG,KAAK,CAACC,IAAlB;AACAL,YAAAA,OAAO,CAACC,GAAR,CAAYG,KAAK,CAACE,OAAlB;AACF,WARF;AASC,SAXD;AAYD;AACF,KAtBD;AAuBA,GAxBQ,EAwBN,CAACtB,WAAD,CAxBM,CAAT;;AA2BC,WAASuB,eAAT,GAA2B;AACzB,WAAO,CAAC3B,CAAC,CAAC4B,WAAF,CAAc3B,QAAQ,CAACM,IAAT,GAAgBe,WAA9B,CAAR;AACD;;AAAA;;AAED,WAASO,MAAT,GAAkB;AAChBzB,IAAAA,WAAW,CAAC,EAAD,CAAX;AACAH,IAAAA,QAAQ,CAACM,IAAT,GAAgBuB,OAAhB;AACD;;AAED,SAAO;AACL3B,IAAAA,QADK;AAELwB,IAAAA,eAFK;AAGLE,IAAAA,MAHK;AAILxB,IAAAA;AAJK,GAAP;AAMD,CA9CD;;AAgDA,eAAeH,SAAf","sourcesContent":["import { useContext, useEffect, useState } from 'react';\nimport JwtContext from '../providers/JwtContext';\nimport _ from 'lodash';\nimport firebase from \"firebase/app\";\n\nconst useAppJwt = () => {\n  const { appToken, setAppToken } = useContext(JwtContext);\n  const [user, setUser] = useState({});\n\n useEffect(() => {\n  firebase.auth().onAuthStateChanged(function(user) {\n    if (user) {\n      setUser(user);\n      user.getIdToken().then((token) => {\n        setAppToken(token);\n      });\n    }\n    if (!user) {\n      var provider = new firebase.auth.GoogleAuthProvider();\n      firebase.auth().setPersistence(firebase.auth.Auth.Persistence.LOCAL)\n      .then(() => {\n      firebase.auth()\n       .signInWithPopup(provider).then(function(result) {\n          console.log(\"token\", firebase.auth().currentUser.getIdToken());\n          setAppToken(firebase.auth().currentUser.getIdToken());\n          console.log(user)\n       }).catch(function(error) {\n          console.log(error.code)\n          console.log(error.message)\n       });\n      });\n    }\n  });\n }, [setAppToken])\n\n\n  function isAuthenticated() {\n    return !_.isUndefined(firebase.auth().currentUser);\n  };\n\n  function logout() {\n    setAppToken('');\n    firebase.auth().signOut();\n  }\n\n  return {\n    appToken,\n    isAuthenticated,\n    logout,\n    user,\n  };\n};\n\nexport default useAppJwt;\n"]},"metadata":{},"sourceType":"module"}